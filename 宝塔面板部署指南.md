# 宝塔面板部署指南

## 问题解决

### npm安装错误解决方案

如果遇到类似以下错误：
```
npm error 404 Not Found - GET https://cdn.npmmirror.com/binaries/npm/vue-router/-/vue-router-4.5.1.tgz
```

**解决步骤：**

1. **清除npm缓存**
```bash
npm cache clean --force
```

2. **删除旧的依赖文件**
```bash
rm -rf node_modules package-lock.json
```

3. **重新安装依赖**
```bash
npm install
```

4. **如果仍然报错，切换npm源**
```bash
# 切换到官方源
npm config set registry https://registry.npmjs.org/

# 或者使用淘宝源
npm config set registry https://registry.npmmirror.com/

# 然后重新安装
npm install
```

## 宝塔面板部署步骤

### 1. 环境准备

在宝塔面板中安装以下软件：
- **Node.js** (推荐版本 16.x 或 18.x)
- **Nginx** (用于静态文件服务)
- **PM2管理器** (可选，用于进程管理)

### 2. 上传项目文件

1. 将项目文件上传到服务器目录，例如：`/www/wwwroot/ai-resume`
2. 在宝塔面板的文件管理中解压项目文件

### 3. 安装依赖和构建

在宝塔面板的终端中执行：

```bash
# 进入项目目录
cd /www/wwwroot/ai-resume

# 安装依赖
npm install

# 构建项目
npm run build
```

### 4. 配置Nginx

在宝塔面板中创建网站：

1. 点击「网站」→「添加站点」
2. 域名填写你的域名
3. 根目录设置为：`/www/wwwroot/ai-resume/dist`
4. 选择PHP版本（可选择纯静态）

**Nginx配置示例：**

```nginx
server {
    listen 80;
    server_name your-domain.com;
    root /www/wwwroot/ai-resume/dist;
    index index.html;
    
    # Vue Router 历史模式支持
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    # 静态资源缓存
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
    
    # Gzip压缩
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
}
```

### 5. SSL证书配置（推荐）

在宝塔面板中：
1. 进入网站设置
2. 点击「SSL」选项卡
3. 选择「Let's Encrypt」免费证书
4. 点击申请证书

### 6. 防火墙设置

确保以下端口已开放：
- **80** (HTTP)
- **443** (HTTPS)

## 常见问题解决

### 1. Node.js版本问题

如果遇到Node.js版本不兼容：

```bash
# 查看当前版本
node -v

# 如果版本过低，在宝塔面板中升级Node.js版本
```

### 2. 权限问题

```bash
# 设置正确的文件权限
chmod -R 755 /www/wwwroot/ai-resume
chown -R www:www /www/wwwroot/ai-resume
```

### 3. 内存不足

如果构建时内存不足：

```bash
# 增加Node.js内存限制
node --max-old-space-size=4096 node_modules/.bin/vite build
```

### 4. 端口占用

```bash
# 查看端口占用
netstat -tlnp | grep :80

# 杀死占用进程
kill -9 <PID>
```

## 自动化部署脚本

创建 `deploy-bt.sh` 脚本：

```bash
#!/bin/bash

# 宝塔面板自动部署脚本

set -e

echo "🚀 开始宝塔面板部署..."

# 项目目录
PROJECT_DIR="/www/wwwroot/ai-resume"

# 进入项目目录
cd $PROJECT_DIR

# 备份旧版本
if [ -d "dist" ]; then
    mv dist dist.backup.$(date +%Y%m%d_%H%M%S)
fi

# 清理缓存
npm cache clean --force
rm -rf node_modules package-lock.json

# 安装依赖
echo "📦 安装依赖..."
npm install

# 构建项目
echo "🔨 构建项目..."
npm run build

# 设置权限
chown -R www:www dist/
chmod -R 755 dist/

echo "✅ 部署完成！"
echo "📁 网站根目录: $PROJECT_DIR/dist"
echo "🌐 请在宝塔面板中配置Nginx指向此目录"
```

## 监控和维护

### 1. 日志查看

在宝塔面板中查看：
- Nginx访问日志：`/www/wwwlogs/your-domain.com.log`
- Nginx错误日志：`/www/wwwlogs/your-domain.com.error.log`

### 2. 性能监控

使用宝塔面板的监控功能：
- CPU使用率
- 内存使用率
- 磁盘使用率
- 网络流量

### 3. 定期备份

在宝塔面板中设置：
- 网站文件备份
- 数据库备份（如有）
- 定期清理日志文件

## 优化建议

1. **启用Gzip压缩**
2. **配置浏览器缓存**
3. **使用CDN加速**
4. **定期更新依赖**
5. **监控网站性能**

---

如遇到其他问题，请查看宝塔面板的错误日志或联系技术支持。